# OpenSSH 重构计划：迈向 Flutter 全平台时代

## 1. 背景与目标
当前版本的 OpenSSH 基于 Electron 架构，存在包体积臃肿（100MB+）、内存占用高、以及无法在移动端（iOS/Android）运行的局限性。
本计划旨在利用 **Flutter (Dart)** 重新构建应用，实现轻量化、高性能且支持全平台的 SSH 客户端。

### 核心目标
- **极致轻量**：桌面端安装包控制在 20MB 以内，内存占用降低 60% 以上。
- **全平台支持**：一套代码覆盖 Windows, macOS, Linux, iOS, Android。
- **性能飞跃**：利用 Dart AOT 编译和高性能渲染引擎，提升终端响应速度。

---

## 2. 技术选型 (The Stack)
- **UI 框架**：Flutter (3.x+)
- **编程语言**：Dart
- **SSH 协议库**：[dartssh2](https://pub.dev/packages/dartssh2) (支持 SSH2, SFTP, 端口转发)
- **终端模拟器**：[xterm.dart](https://pub.dev/packages/xterm) (高性能终端渲染)
- **本地存储**：[Isar](https://isar.dev/) (极速、强类型的本地 NoSQL 数据库)
- **状态管理**：[Riverpod](https://riverpod.dev/) (安全、可预测的状态管理)
- **国际化**：`flutter_localizations` & `easy_localization`

---

## 3. 详细重构阶段

### 第一阶段：基础设施与数据模型 (预计 1-2 周)
1. **环境搭建**：初始化 Flutter 项目，配置多平台编译环境。
2. **数据持久化**：
   - 使用 Isar 定义 `Host` 模型（主机名、IP、端口、账号、分组）。
   - 实现加密存储模块，安全存放密钥和密码（集成 `flutter_secure_storage`）。
3. **SSH 核心服务**：
   - 封装 `SSHService` 类，基于 `dartssh2` 实现连接池管理、心跳保活、断线重连逻辑。

### 第二阶段：核心功能迁移 (预计 2-3 周)
1. **终端窗格 (Terminal)**：
   - 集成 `xterm.dart`。
   - 实现双端适配：桌面端支持快捷键映射；移动端增加“辅助键盘行”（Tab, Ctrl, Alt, Esc）。
2. **SFTP 文件管理器**：
   - 移植现有的 SFTP 逻辑，实现文件上传/下载、目录切换、权限修改。
   - 适配移动端文件系统接口。
3. **多会话管理**：
   - 实现类似浏览器的标签页（Tab）系统。

### 第三阶段：UI/UX 优化与移动端适配 (预计 1-2 周)
1. **自适应布局**：
   - 桌面端：左侧边栏 + 右侧多标签页。
   - 移动端：底部导航栏 + 抽屉式（Drawer）主机列表。
2. **交互细节**：
   - 增加深色模式（Dark Mode）与自定义主题色。
   - 优化终端字体渲染与光标性能。

---

## 4. 关键挑战与对策
- **挑战**：移动端 SSH 连接在后台易被系统杀掉。
  - **对策**：实现前台服务（Android）和 Push 通知提醒，并在重回前台时自动快速重连。
- **挑战**：大量的现有 Vue 逻辑迁移。
  - **对策**：采用组件化思路，将原有的 Vue 组件逻辑按功能块拆解为 Dart Class，通过 Riverpod 进行状态同步。

---

## 5. 预期成果
- 一个跨平台的 `.ipa` / `.apk` 安装包。
- 极速启动且资源占用极低的桌面客户端。
- 统一的代码库，降低后续功能开发的维护成本。

---
**编写者**：蝎子莱莱 (Powered by OpenClaw)
**日期**：2026-02-23
