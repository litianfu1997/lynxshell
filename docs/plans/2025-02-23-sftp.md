# SFTP æ–‡ä»¶æµè§ˆå™¨å®ç°è®¡åˆ’

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**ç›®æ ‡:** ä¸º OpenSSH Client æ·»åŠ å…¨åŠŸèƒ½ SFTP æ–‡ä»¶æµè§ˆå™¨ï¼Œæ”¯æŒæ–‡ä»¶æµè§ˆã€ä¸Šä¼ ã€ä¸‹è½½ã€ç®¡ç†ã€é¢„è§ˆå’Œåœ¨çº¿ç¼–è¾‘ã€‚

**æ¶æ„:** é‡‡ç”¨æ–¹æ¡ˆ Aï¼ˆå•ç»„ä»¶ + å­ç»„ä»¶ï¼‰ï¼ŒSftpPane ä½œä¸ºä¸»å®¹å™¨ï¼Œå†…éƒ¨åŒ…å«å¤šä¸ªå­ç»„ä»¶ï¼ˆSftpTreeã€SftpFileListã€SftpPreview ç­‰ï¼‰ã€‚IPC è°ƒç”¨ç»Ÿä¸€åœ¨ä¸»å®¹å™¨å¤„ç†ï¼Œå­ç»„ä»¶é€šè¿‡ props/events é€šä¿¡ã€‚SFTP ä¼šè¯å¤ç”¨ç°æœ‰ SSH è¿æ¥ã€‚

**æŠ€æœ¯æ ˆ:**
- å‰ç«¯: Vue 3 + TypeScript + xterm.js
- åç«¯: Electron (ssh2 åº“)
- æ„å»º: electron-vite

---

## Task 1: æ‰©å±• ssh-manager.js SFTP åŠŸèƒ½

**Files:**
- Modify: `src/main/ssh-manager.js`

**Step 1: æ·»åŠ æ–‡ä»¶ä¸Šä¼ å‡½æ•°**

åœ¨ `ssh-manager.js` ä¸­ `listRemoteDirectory` å‡½æ•°åæ·»åŠ ï¼š

```javascript
/**
 * ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨
 * @param {string} sessionId
 * @param {string} localPath æœ¬åœ°æ–‡ä»¶è·¯å¾„
 * @param {string} remotePath è¿œç¨‹ç›®æ ‡è·¯å¾„
 * @param {Function} onProgress è¿›åº¦å›è°ƒ (bytesSent, totalBytes)
 */
export async function uploadFile(sessionId, localPath, remotePath, onProgress) {
    const sftp = await getSFTP(sessionId)
    const fs = await import('fs')

    return new Promise((resolve, reject) => {
        const stats = fs.statSync(localPath)
        const readStream = fs.createReadStream(localPath)
        const writeStream = sftp.createWriteStream(remotePath)

        let bytesSent = 0

        readStream.on('data', (chunk) => {
            bytesSent += chunk.length
            if (onProgress) onProgress(bytesSent, stats.size)
        })

        writeStream.on('close', () => resolve({ success: true }))
        writeStream.on('error', reject)
        readStream.on('error', reject)

        readStream.pipe(writeStream)
    })
}
```

**Step 2: æ·»åŠ æ–‡ä»¶ä¸‹è½½å‡½æ•°**

```javascript
/**
 * ä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶
 * @param {string} sessionId
 * @param {string} remotePath è¿œç¨‹æ–‡ä»¶è·¯å¾„
 * @param {string} localPath æœ¬åœ°ç›®æ ‡è·¯å¾„
 * @param {Function} onProgress è¿›åº¦å›è°ƒ
 */
export async function downloadFile(sessionId, remotePath, localPath, onProgress) {
    const sftp = await getSFTP(sessionId)
    const fs = await import('fs')

    return new Promise((resolve, reject) => {
        const readStream = sftp.createReadStream(remotePath)
        const writeStream = fs.createWriteStream(localPath)

        let bytesReceived = 0

        // è·å–è¿œç¨‹æ–‡ä»¶å¤§å°
        sftp.stat(remotePath, (err, stats) => {
            if (err) return reject(err)

            readStream.on('data', (chunk) => {
                bytesReceived += chunk.length
                if (onProgress) onProgress(bytesReceived, stats.size)
            })

            readStream.on('close', () => resolve({ success: true }))
            readStream.on('error', reject)
            writeStream.on('error', reject)

            readStream.pipe(writeStream)
        })
    })
}
```

**Step 3: æ·»åŠ æ–‡ä»¶åˆ é™¤å‡½æ•°**

```javascript
/**
 * åˆ é™¤è¿œç¨‹æ–‡ä»¶æˆ–ç›®å½•
 * @param {string} sessionId
 * @param {string} path è¿œç¨‹è·¯å¾„
 */
export async function deletePath(sessionId, path) {
    const sftp = await getSFTP(sessionId)
    return new Promise((resolve, reject) => {
        sftp.unlink(path, (err) => {
            if (err) return reject(err)
            resolve({ success: true })
        })
    })
}
```

**Step 4: æ·»åŠ ç›®å½•åˆ é™¤å‡½æ•°ï¼ˆé€’å½’ï¼‰**

```javascript
/**
 * é€’å½’åˆ é™¤è¿œç¨‹ç›®å½•
 * @param {string} sessionId
 * @param {string} dirPath è¿œç¨‹ç›®å½•è·¯å¾„
 */
async function deleteDirectoryRecursive(sessionId, dirPath) {
    const sftp = await getSFTP(sessionId)
    const list = await listRemoteDirectory(sessionId, dirPath)

    for (const item of list) {
        const fullPath = `${dirPath}/${item.name}`
        if (item.type === 'directory') {
            await deleteDirectoryRecursive(sessionId, fullPath)
        } else {
            await new Promise((resolve, reject) => {
                sftp.unlink(fullPath, (err) => err ? reject(err) : resolve())
            })
        }
    }

    return new Promise((resolve, reject) => {
        sftp.rmdir(dirPath, (err) => err ? reject(err) : resolve())
    })
}
```

**Step 5: æ·»åŠ é‡å‘½åå‡½æ•°**

```javascript
/**
 * é‡å‘½åè¿œç¨‹æ–‡ä»¶æˆ–ç›®å½•
 * @param {string} sessionId
 * @param {string} oldPath åŸè·¯å¾„
 * @param {string} newPath æ–°è·¯å¾„
 */
export async function renamePath(sessionId, oldPath, newPath) {
    const sftp = await getSFTP(sessionId)
    return new Promise((resolve, reject) => {
        sftp.rename(oldPath, newPath, (err) => {
            if (err) return reject(err)
            resolve({ success: true })
        })
    })
}
```

**Step 6: æ·»åŠ åˆ›å»ºç›®å½•å‡½æ•°**

```javascript
/**
 * åˆ›å»ºè¿œç¨‹ç›®å½•
 * @param {string} sessionId
 * @param {string} path ç›®å½•è·¯å¾„
 */
export async function mkdir(sessionId, path) {
    const sftp = await getSFTP(sessionId)
    return new Promise((resolve, reject) => {
        sftp.mkdir(path, (err) => {
            if (err) return reject(err)
            resolve({ success: true })
        })
    })
}
```

**Step 7: æ·»åŠ ç§»åŠ¨æ–‡ä»¶å‡½æ•°**

```javascript
/**
 * ç§»åŠ¨è¿œç¨‹æ–‡ä»¶æˆ–ç›®å½•
 * @param {string} sessionId
 * @param {string} oldPath åŸè·¯å¾„
 * @param {string} newPath æ–°è·¯å¾„
 */
export async function movePath(sessionId, oldPath, newPath) {
    const sftp = await getSFTP(sessionId)
    return new Promise((resolve, reject) => {
        sftp.rename(oldPath, newPath, (err) => {
            if (err) return reject(err)
            resolve({ success: true })
        })
    })
}
```

**Step 8: æ·»åŠ è¯»å–æ–‡ä»¶å†…å®¹å‡½æ•°ï¼ˆç”¨äºé¢„è§ˆ/ç¼–è¾‘ï¼‰**

```javascript
/**
 * è¯»å–è¿œç¨‹æ–‡ä»¶å†…å®¹
 * @param {string} sessionId
 * @param {string} path æ–‡ä»¶è·¯å¾„
 */
export async function readFile(sessionId, path) {
    const sftp = await getSFTP(sessionId)
    return new Promise((resolve, reject) => {
        sftp.readFile(path, 'utf8', (err, data) => {
            if (err) return reject(err)
            resolve({ content: data })
        })
    })
}
```

**Step 9: æ·»åŠ ä¿å­˜æ–‡ä»¶å†…å®¹å‡½æ•°ï¼ˆç”¨äºåœ¨çº¿ç¼–è¾‘ï¼‰**

```javascript
/**
 * ä¿å­˜å†…å®¹åˆ°è¿œç¨‹æ–‡ä»¶
 * @param {string} sessionId
 * @param {string} path æ–‡ä»¶è·¯å¾„
 * @param {string} content æ–‡ä»¶å†…å®¹
 */
export async function writeFile(sessionId, path, content) {
    const sftp = await getSFTP(sessionId)
    return new Promise((resolve, reject) => {
        sftp.writeFile(path, content, 'utf8', (err) => {
            if (err) return reject(err)
            resolve({ success: true })
        })
    })
}
```

**Step 10: æ·»åŠ è·å–æ–‡ä»¶ä¿¡æ¯å‡½æ•°**

```javascript
/**
 * è·å–è¿œç¨‹æ–‡ä»¶ä¿¡æ¯
 * @param {string} sessionId
 * @param {string} path æ–‡ä»¶è·¯å¾„
 */
export async function getStats(sessionId, path) {
    const sftp = await getSFTP(sessionId)
    return new Promise((resolve, reject) => {
        sftp.stat(path, (err, stats) => {
            if (err) return reject(err)
            resolve({
                size: stats.size,
                mode: stats.mode,
                mtime: stats.mtime * 1000,
                atime: stats.atime * 1000,
                isDirectory: stats.isDirectory()
            })
        })
    })
}
```

**Step 11: æ·»åŠ è·å–ç›®å½•æ ‘å‡½æ•°**

```javascript
/**
 * è·å–ç›®å½•æ ‘ç»“æ„ï¼ˆç”¨äºå·¦ä¾§æ ‘å½¢ç»„ä»¶ï¼‰
 * @param {string} sessionId
 * @param {string} rootPath æ ¹è·¯å¾„
 * @param {number} depth æœ€å¤§é€’å½’æ·±åº¦
 */
export async function getDirectoryTree(sessionId, rootPath = '.', depth = 3) {
    if (depth === 0) return []

    const list = await listRemoteDirectory(sessionId, rootPath)
    const nodes = []

    for (const item of list) {
        if (item.type === 'directory') {
            const fullPath = rootPath === '.' ? item.name : `${rootPath}/${item.name}`
            nodes.push({
                name: item.name,
                path: fullPath,
                type: 'directory',
                children: await getDirectoryTree(sessionId, fullPath, depth - 1)
            })
        }
    }

    return nodes
}
```

**Step 12: Commit**

```bash
git add src/main/ssh-manager.js
git commit -m "feat(sftp): add core SFTP operations (upload, download, delete, rename, mkdir, move, readFile, writeFile, getStats, getDirectoryTree)"
```

---

## Task 2: æ‰©å±• IPC å¤„ç†å™¨

**Files:**
- Modify: `src/main/index.js`

**Step 1: å¯¼å…¥æ–°çš„ SFTP å‡½æ•°**

åœ¨ `src/main/index.js` é¡¶éƒ¨ï¼Œæ›´æ–° import è¯­å¥ï¼š

```javascript
import { createSSHConnection, closeSSHConnection, resizeSSHTerminal, getSshConnections, testSSHConnection, listRemoteDirectory, uploadFile, downloadFile, deletePath, renamePath, mkdir, movePath, readFile, writeFile, getStats, getDirectoryTree } from './ssh-manager'
```

**Step 2: æ·»åŠ  SFTP æ“ä½œ IPC å¤„ç†å™¨**

åœ¨ `app.whenReady()` ä¸­ï¼Œæ‰¾åˆ° `// SFTP IPC` éƒ¨åˆ†ï¼Œæ·»åŠ ä»¥ä¸‹å¤„ç†å™¨ï¼š

```javascript
// SFTP IPC - å·²æœ‰çš„
ipcMain.handle('sftp:ls', async (_, { sessionId, path }) => {
    return listRemoteDirectory(sessionId, path)
})

// ä¸Šä¼ æ–‡ä»¶
ipcMain.handle('sftp:upload', async (_, { sessionId, localPath, remotePath }) => {
    return uploadFile(sessionId, localPath, remotePath, (bytes, total) => {
        // å‘é€è¿›åº¦äº‹ä»¶
        mainWindow.webContents.send('sftp:upload-progress', { sessionId, localPath, remotePath, bytes, total })
    })
})

// ä¸‹è½½æ–‡ä»¶
ipcMain.handle('sftp:download', async (event, { sessionId, remotePath, localPath }) => {
    const win = BrowserWindow.fromWebContents(event.sender)
    return downloadFile(sessionId, remotePath, localPath, (bytes, total) => {
        win?.webContents.send('sftp:download-progress', { sessionId, remotePath, localPath, bytes, total })
    })
})

// åˆ é™¤æ–‡ä»¶
ipcMain.handle('sftp:delete', async (_, { sessionId, path }) => {
    return deletePath(sessionId, path)
})

// é‡å‘½å
ipcMain.handle('sftp:rename', async (_, { sessionId, oldPath, newPath }) => {
    return renamePath(sessionId, oldPath, newPath)
})

// åˆ›å»ºç›®å½•
ipcMain.handle('sftp:mkdir', async (_, { sessionId, path }) => {
    return mkdir(sessionId, path)
})

// ç§»åŠ¨æ–‡ä»¶
ipcMain.handle('sftp:move', async (_, { sessionId, oldPath, newPath }) => {
    return movePath(sessionId, oldPath, newPath)
})

// è¯»å–æ–‡ä»¶å†…å®¹
ipcMain.handle('sftp:getFile', async (_, { sessionId, path }) => {
    return readFile(sessionId, path)
})

// ä¿å­˜æ–‡ä»¶å†…å®¹
ipcMain.handle('sftp:putFile', async (_, { sessionId, path, content }) => {
    return writeFile(sessionId, path, content)
})

// è·å–æ–‡ä»¶ä¿¡æ¯
ipcMain.handle('sftp:stat', async (_, { sessionId, path }) => {
    return getStats(sessionId, path)
})

// è·å–ç›®å½•æ ‘
ipcMain.handle('sftp:tree', async (_, { sessionId, rootPath, depth }) => {
    return getDirectoryTree(sessionId, rootPath, depth)
})
```

**Step 3: Commit**

```bash
git add src/main/index.js
git commit -m "feat(ipc): add SFTP operation handlers"
```

---

## Task 3: æ‰©å±• Preload API

**Files:**
- Modify: `src/preload/index.js`

**Step 1: æ·»åŠ  SFTP æ“ä½œ API**

åœ¨ `src/preload/index.js` ä¸­ï¼Œæ‰©å±• `sftp` å¯¹è±¡ï¼š

```javascript
// SFTP æ“ä½œ
sftp: {
    ls: (sessionId, path) => ipcRenderer.invoke('sftp:ls', { sessionId, path }),
    upload: (sessionId, localPath, remotePath) => ipcRenderer.invoke('sftp:upload', { sessionId, localPath, remotePath }),
    download: (sessionId, remotePath, localPath) => ipcRenderer.invoke('sftp:download', { sessionId, remotePath, localPath }),
    delete: (sessionId, path) => ipcRenderer.invoke('sftp:delete', { sessionId, path }),
    rename: (sessionId, oldPath, newPath) => ipcRenderer.invoke('sftp:rename', { sessionId, oldPath, newPath }),
    mkdir: (sessionId, path) => ipcRenderer.invoke('sftp:mkdir', { sessionId, path }),
    move: (sessionId, oldPath, newPath) => ipcRenderer.invoke('sftp:move', { sessionId, oldPath, newPath }),
    getFile: (sessionId, path) => ipcRenderer.invoke('sftp:getFile', { sessionId, path }),
    putFile: (sessionId, path, content) => ipcRenderer.invoke('sftp:putFile', { sessionId, path, content }),
    stat: (sessionId, path) => ipcRenderer.invoke('sftp:stat', { sessionId, path }),
    tree: (sessionId, rootPath, depth) => ipcRenderer.invoke('sftp:tree', { sessionId, rootPath, depth }),
    // äº‹ä»¶ç›‘å¬
    onUploadProgress: (callback) => ipcRenderer.on('sftp:upload-progress', (_, data) => callback(data)),
    onDownloadProgress: (callback) => ipcRenderer.on('sftp:download-progress', (_, data) => callback(data)),
    removeUploadProgressListener: () => ipcRenderer.removeAllListeners('sftp:upload-progress'),
    removeDownloadProgressListener: () => ipcRenderer.removeAllListeners('sftp:download-progress')
}
```

**Step 2: Commit**

```bash
git add src/preload/index.js
git commit -m "feat(preload): expose SFTP operations to renderer"
```

---

## Task 4: åˆ›å»º SftpPane ä¸»å®¹å™¨ç»„ä»¶

**Files:**
- Create: `src/renderer/src/components/SftpPane.vue`

**Step 1: åˆ›å»ºç»„ä»¶åŸºç¡€ç»“æ„**

```vue
<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'

// Props
const props = defineProps({
  session: {
    type: Object,
    required: true
  }
})

// çŠ¶æ€
const currentPath = ref('.')
const fileList = ref([])
const treeData = ref([])
const selectedFiles = ref([])
const previewFile = ref(null)
const bookmarks = ref([])
const transfers = ref([])
const isTreeLoading = ref(false)
const isListLoading = ref(false)
const showPreview = ref(false)

// è®¡ç®—å±æ€§
const currentDirName = computed(() => {
  if (currentPath.value === '.') return '/'
  return currentPath.value.split('/').pop() || '/'
})

// æ–¹æ³•
const loadDirectory = async (path) => {
  isListLoading.value = true
  try {
    const result = await window.electronAPI.sftp.ls(props.session.id, path)
    fileList.value = result
    currentPath.value = path
  } catch (error) {
    console.error('Failed to load directory:', error)
  } finally {
    isListLoading.value = false
  }
}

const loadTree = async () => {
  isTreeLoading.value = true
  try {
    const result = await window.electronAPI.sftp.tree(props.session.id, '.', 2)
    treeData.value = result
  } catch (error) {
    console.error('Failed to load tree:', error)
  } finally {
    isTreeLoading.value = false
  }
}

const refresh = () => {
  loadDirectory(currentPath.value)
  loadTree()
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadDirectory('.')
  loadTree()
})

// ç›‘å¬ä¸Šä¼ è¿›åº¦
onMounted(() => {
  window.electronAPI.sftp.onUploadProgress((data) => {
    if (data.sessionId === props.session.id) {
      const transfer = transfers.value.find(t => t.localPath === data.localPath)
      if (transfer) {
        transfer.progress = (data.bytes / data.total) * 100
        transfer.speed = data.bytes
      }
    }
  })
})

onUnmounted(() => {
  window.electronAPI.sftp.removeUploadProgressListener()
})
</script>

<template>
  <div class="sftp-pane">
    <div class="sftp-content">
      <!-- å†…å®¹å°†åœ¨åç»­ä»»åŠ¡ä¸­å¡«å…… -->
      <p>SFTP Browser for session: {{ session.id }}</p>
      <p>Current path: {{ currentPath }}</p>
      <p>Files: {{ fileList.length }}</p>
    </div>
  </div>
</template>

<style scoped>
.sftp-pane {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-color);
  color: var(--text-color);
}

.sftp-content {
  flex: 1;
  padding: 20px;
  overflow: auto;
}
</style>
```

**Step 2: Commit**

```bash
git add src/renderer/src/components/SftpPane.vue
git commit -m "feat(sftp): create SftpPane main container component"
```

---

## Task 5: åˆ›å»º SftpToolbar å·¥å…·æ ç»„ä»¶

**Files:**
- Create: `src/renderer/src/components/SftpToolbar.vue`

**Step 1: åˆ›å»ºå·¥å…·æ ç»„ä»¶**

```vue
<script setup lang="ts">
const props = defineProps({
  selectedCount: {
    type: Number,
    default: 0
  }
})

const emit = defineEmits([
  'upload',
  'download',
  'delete',
  'mkdir',
  'refresh',
  'togglePreview',
  'addBookmark'
])

const handleUpload = () => {
  emit('upload')
}

const handleDownload = () => {
  emit('download')
}

const handleDelete = () => {
  emit('delete')
}

const handleMkdir = () => {
  emit('mkdir')
}

const handleRefresh = () => {
  emit('refresh')
}
</script>

<template>
  <div class="sftp-toolbar">
    <button @click="handleMkdir" title="æ–°å»ºæ–‡ä»¶å¤¹">
      <span>ğŸ“+</span>
    </button>
    <button @click="handleUpload" title="ä¸Šä¼ æ–‡ä»¶">
      <span>â†‘ ä¸Šä¼ </span>
    </button>
    <button @click="handleDownload" :disabled="selectedCount === 0" title="ä¸‹è½½æ–‡ä»¶">
      <span>â†“ ä¸‹è½½</span>
    </button>
    <button @click="handleDelete" :disabled="selectedCount === 0" title="åˆ é™¤">
      <span>ğŸ—‘ï¸</span>
    </button>
    <button @click="handleRefresh" title="åˆ·æ–°">
      <span>ğŸ”„</span>
    </button>
    <button @click="emit('togglePreview')" title="åˆ‡æ¢é¢„è§ˆ">
      <span>ğŸ‘ï¸</span>
    </button>
    <button @click="emit('addBookmark')" title="æ·»åŠ æ”¶è—">
      <span>â­</span>
    </button>
  </div>
</template>

<style scoped>
.sftp-toolbar {
  display: flex;
  gap: 8px;
  padding: 8px 12px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
}

.sftp-toolbar button {
  padding: 6px 12px;
  border: 1px solid var(--border-color);
  background: var(--bg-color);
  color: var(--text-color);
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 14px;
}

.sftp-toolbar button:hover:not(:disabled) {
  background: var(--hover-bg);
}

.sftp-toolbar button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>
```

**Step 2: Commit**

```bash
git add src/renderer/src/components/SftpToolbar.vue
git commit -m "feat(sftp): create SftpToolbar component"
```

---

## Task 6: åˆ›å»º SftpBreadcrumb é¢åŒ…å±‘ç»„ä»¶

**Files:**
- Create: `src/renderer/src/components/SftpBreadcrumb.vue`

**Step 1: åˆ›å»ºé¢åŒ…å±‘ç»„ä»¶**

```vue
<script setup lang="ts">
import { computed } from 'vue'

const props = defineProps({
  path: {
    type: String,
    default: '.'
  }
})

const emit = defineEmits(['navigate'])

const breadcrumbs = computed(() => {
  if (props.path === '.') return [{ name: '/', path: '.' }]

  const parts = props.path.split('/')
  const result = []
  let currentPath = ''

  for (let i = 0; i < parts.length; i++) {
    const part = parts[i]
    currentPath = i === 0 ? part : `${currentPath}/${part}`
    result.push({
      name: part || '/',
      path: i === parts.length - 1 ? props.path : currentPath
    })
  }

  return result
})

const handleNavigate = (path) => {
  emit('navigate', path)
}
</script>

<template>
  <div class="sftp-breadcrumb">
    <span
      v-for="(crumb, index) in breadcrumbs"
      :key="index"
      class="breadcrumb-item"
      :class="{ 'is-last': index === breadcrumbs.length - 1 }"
      @click="handleNavigate(crumb.path)"
    >
      {{ crumb.name }}
      <span v-if="index < breadcrumbs.length - 1" class="separator">/</span>
    </span>
  </div>
</template>

<style scoped>
.sftp-breadcrumb {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  background: var(--bg-color);
  border-bottom: 1px solid var(--border-color);
  font-size: 14px;
}

.breadcrumb-item {
  cursor: pointer;
  color: var(--text-color);
}

.breadcrumb-item:hover:not(.is-last) {
  color: var(--accent-color);
}

.breadcrumb-item.is-last {
  cursor: default;
  font-weight: 500;
}

.separator {
  margin: 0 4px;
  color: var(--text-secondary);
}
</style>
```

**Step 2: Commit**

```bash
git add src/renderer/src/components/SftpBreadcrumb.vue
git commit -m "feat(sftp): create SftpBreadcrumb component"
```

---

## Task 7: åˆ›å»º SftpTree ç›®å½•æ ‘ç»„ä»¶

**Files:**
- Create: `src/renderer/src/components/SftpTree.vue`

**Step 1: åˆ›å»ºç›®å½•æ ‘ç»„ä»¶**

```vue
<script setup lang="ts">
import { ref } from 'vue'

const props = defineProps({
  treeData: {
    type: Array,
    default: () => []
  },
  currentPath: {
    type: String,
    default: '.'
  },
  loading: {
    type: Boolean,
    default: false
  }
})

const emit = defineEmits(['navigate'])

const expandedNodes = ref(new Set(['.']))

const toggleExpand = (node) => {
  if (expandedNodes.value.has(node.path)) {
    expandedNodes.value.delete(node.path)
  } else {
    expandedNodes.value.add(node.path)
  }
}

const handleNodeClick = (node) => {
  emit('navigate', node.path)
}

const isExpanded = (path) => expandedNodes.value.has(path)

const isSelected = (path) => path === props.currentPath
</script>

<template>
  <div class="sftp-tree">
    <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
    <div v-else class="tree-root">
      <TreeNode
        v-for="node in treeData"
        :key="node.path"
        :node="node"
        :expanded="isExpanded(node.path)"
        :selected="isSelected(node.path)"
        @toggle="toggleExpand"
        @select="handleNodeClick"
      />
    </div>
  </div>
</template>

<style scoped>
.sftp-tree {
  width: 250px;
  border-right: 1px solid var(--border-color);
  overflow: auto;
  background: var(--bg-secondary);
}

.loading {
  padding: 20px;
  text-align: center;
  color: var(--text-secondary);
}

.tree-root {
  padding: 8px 0;
}
</style>

<script>
// é€’å½’å­ç»„ä»¶
const TreeNode = {
  name: 'TreeNode',
  props: ['node', 'expanded', 'selected'],
  emits: ['toggle', 'select'],
  template: `
    <div class="tree-node">
      <div
        class="tree-node-content"
        :class="{ 'is-selected': selected }"
        @click="$emit('select', node)"
        @click.stop="$emit('toggle', node)"
      >
        <span class="expand-icon">{{ node.children?.length ? (expanded ? 'â–¼' : 'â–¶') : '  ' }}</span>
        <span class="folder-icon">ğŸ“</span>
        <span class="node-name">{{ node.name }}</span>
      </div>
      <div v-if="expanded && node.children?.length" class="tree-node-children">
        <TreeNode
          v-for="child in node.children"
          :key="child.path"
          :node="child"
          :expanded="false"
          :selected="selected"
          @toggle="$emit('toggle', $event)"
          @select="$emit('select', $event)"
        />
      </div>
    </div>
  `
}
</script>
```

**Step 2: Commit**

```bash
git add src/renderer/src/components/SftpTree.vue
git commit -m "feat(sftp): create SftpTree component"
```

---

## Task 8: åˆ›å»º SftpFileList æ–‡ä»¶åˆ—è¡¨ç»„ä»¶

**Files:**
- Create: `src/renderer/src/components/SftpFileList.vue`

**Step 1: åˆ›å»ºæ–‡ä»¶åˆ—è¡¨ç»„ä»¶**

```vue
<script setup lang="ts">
import { ref, computed } from 'vue'

const props = defineProps({
  files: {
    type: Array,
    default: () => []
  },
  loading: {
    type: Boolean,
    default: false
  }
})

const emit = defineEmits(['select', 'dblclick', 'delete', 'rename'])

const selectedIndices = ref(new Set())

const sortedFiles = computed(() => {
  return [...props.files].sort((a, b) => {
    if (a.type === 'directory' && b.type !== 'directory') return -1
    if (a.type !== 'directory' && b.type === 'directory') return 1
    return a.name.localeCompare(b.name)
  })
})

const toggleSelect = (index, event) => {
  if (event.ctrlKey || event.metaKey) {
    if (selectedIndices.value.has(index)) {
      selectedIndices.value.delete(index)
    } else {
      selectedIndices.value.add(index)
    }
  } else if (event.shiftKey) {
    // Range selection
    const indices = Array.from(selectedIndices.value)
    const lastSelected = indices.length > 0 ? Math.max(...indices) : 0
    const start = Math.min(lastSelected, index)
    const end = Math.max(lastSelected, index)
    for (let i = start; i <= end; i++) {
      selectedIndices.value.add(i)
    }
  } else {
    selectedIndices.value.clear()
    selectedIndices.value.add(index)
  }
  emit('select', Array.from(selectedIndices.value).map(i => sortedFiles.value[i]))
}

const handleDblClick = (file) => {
  emit('dblclick', file)
}

const getIcon = (file) => {
  if (file.type === 'directory') return 'ğŸ“'
  const ext = file.name.split('.').pop()?.toLowerCase()
  const iconMap = {
    txt: 'ğŸ“„',
    md: 'ğŸ“',
    pdf: 'ğŸ“•',
    jpg: 'ğŸ–¼ï¸',
    jpeg: 'ğŸ–¼ï¸',
    png: 'ğŸ–¼ï¸',
    gif: 'ğŸ–¼ï¸',
    svg: 'ğŸ¨',
    mp3: 'ğŸµ',
    mp4: 'ğŸ¬',
    zip: 'ğŸ“¦',
    tar: 'ğŸ“¦',
    gz: 'ğŸ“¦',
    js: 'ğŸ“œ',
    ts: 'ğŸ“œ',
    py: 'ğŸ',
    json: 'ğŸ“‹',
    html: 'ğŸŒ',
    css: 'ğŸ¨'
  }
  return iconMap[ext] || 'ğŸ“„'
}

const formatSize = (bytes) => {
  if (!bytes) return '-'
  const units = ['B', 'KB', 'MB', 'GB']
  let i = 0
  while (bytes >= 1024 && i < units.length - 1) {
    bytes /= 1024
    i++
  }
  return `${bytes.toFixed(1)} ${units[i]}`
}

const formatDate = (timestamp) => {
  if (!timestamp) return '-'
  return new Date(timestamp).toLocaleString()
}
</script>

<template>
  <div class="sftp-file-list">
    <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
    <div v-else-if="sortedFiles.length === 0" class="empty">
      æ­¤æ–‡ä»¶å¤¹ä¸ºç©º
    </div>
    <div v-else class="file-list-container">
      <div
        v-for="(file, index) in sortedFiles"
        :key="file.name"
        class="file-item"
        :class="{ 'is-selected': selectedIndices.has(index) }"
        @click="toggleSelect(index, $event)"
        @dblclick="handleDblClick(file)"
      >
        <span class="file-icon">{{ getIcon(file) }}</span>
        <span class="file-name">{{ file.name }}</span>
        <span class="file-size">{{ formatSize(file.size) }}</span>
        <span class="file-date">{{ formatDate(file.mtime) }}</span>
      </div>
    </div>
  </div>
</template>

<style scoped>
.sftp-file-list {
  flex: 1;
  overflow: auto;
  background: var(--bg-color);
}

.loading, .empty {
  padding: 40px;
  text-align: center;
  color: var(--text-secondary);
}

.file-list-container {
  padding: 8px;
}

.file-item {
  display: grid;
  grid-template-columns: 30px 1fr 100px 180px;
  gap: 12px;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  align-items: center;
  font-size: 14px;
}

.file-item:hover {
  background: var(--hover-bg);
}

.file-item.is-selected {
  background: var(--selection-bg);
  color: var(--selection-text);
}

.file-name {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.file-size, .file-date {
  color: var(--text-secondary);
  font-size: 13px;
}
</style>
```

**Step 2: Commit**

```bash
git add src/renderer/src/components/SftpFileList.vue
git commit -m "feat(sftp): create SftpFileList component"
```

---

## Task 9: åˆ›å»º SftpPreview é¢„è§ˆç»„ä»¶

**Files:**
- Create: `src/renderer/src/components/SftpPreview.vue`

**Step 1: åˆ›å»ºé¢„è§ˆç»„ä»¶**

```vue
<script setup lang="ts">
import { ref, watch, computed } from 'vue'

const props = defineProps({
  file: {
    type: Object,
    default: null
  },
  sessionId: {
    type: String,
    required: true
  }
})

const emit = defineEmits(['close'])

const content = ref('')
const loading = ref(false)
const error = ref(null)
const isImage = computed(() => {
  if (!props.file) return false
  const ext = props.file.name.split('.').pop()?.toLowerCase()
  return ['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp'].includes(ext)
})

const isText = computed(() => {
  if (!props.file) return false
  const ext = props.file.name.split('.').pop()?.toLowerCase()
  return ['txt', 'md', 'json', 'js', 'ts', 'py', 'html', 'css', 'xml', 'yaml', 'yml'].includes(ext)
})

watch(() => props.file, async (newFile) => {
  if (!newFile || !isText.value) {
    content.value = ''
    error.value = null
    return
  }

  loading.value = true
  error.value = null

  try {
    const result = await window.electronAPI.sftp.getFile(props.sessionId, newFile.path || `${newFile.name}`)
    content.value = result.content
  } catch (err) {
    error.value = err.message || 'æ— æ³•åŠ è½½æ–‡ä»¶'
  } finally {
    loading.value = false
  }
}, { immediate: true })

const handleClose = () => {
  emit('close')
}
</script>

<template>
  <div v-if="file" class="sftp-preview">
    <div class="preview-header">
      <span class="file-name">{{ file.name }}</span>
      <button @click="handleClose" class="close-btn">Ã—</button>
    </div>
    <div class="preview-content">
      <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
      <div v-else-if="error" class="error">{{ error }}</div>
      <div v-else-if="isImage" class="image-preview">
        <img :src="`file://${file.path}`" :alt="file.name" />
      </div>
      <div v-else-if="isText" class="text-preview">
        <pre>{{ content }}</pre>
      </div>
      <div v-else class="unsupported">
        æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒé¢„è§ˆ
      </div>
    </div>
  </div>
</template>

<style scoped>
.sftp-preview {
  height: 300px;
  border-top: 1px solid var(--border-color);
  background: var(--bg-secondary);
  display: flex;
  flex-direction: column;
}

.preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: var(--bg-color);
  border-bottom: 1px solid var(--border-color);
}

.file-name {
  font-weight: 500;
  font-size: 14px;
}

.close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: var(--text-secondary);
}

.close-btn:hover {
  color: var(--text-color);
}

.preview-content {
  flex: 1;
  overflow: auto;
  padding: 12px;
}

.loading, .error, .unsupported {
  padding: 20px;
  text-align: center;
  color: var(--text-secondary);
}

.error {
  color: var(--error-color);
}

.image-preview img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.text-preview pre {
  margin: 0;
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 13px;
  white-space: pre-wrap;
  word-break: break-all;
}
</style>
```

**Step 2: Commit**

```bash
git add src/renderer/src/components/SftpPreview.vue
git commit -m "feat(sftp): create SftpPreview component"
```

---

## Task 10: åˆ›å»º TransferQueue ä¼ è¾“é˜Ÿåˆ—ç»„ä»¶

**Files:**
- Create: `src/renderer/src/components/TransferQueue.vue`

**Step 1: åˆ›å»ºä¼ è¾“é˜Ÿåˆ—ç»„ä»¶**

```vue
<script setup lang="ts">
import { ref } from 'vue'

const props = defineProps({
  transfers: {
    type: Array,
    default: () => []
  }
})

const emit = defineEmits(['cancel', 'pause', 'resume'])

const expanded = ref(true)

const toggleExpand = () => {
  expanded.value = !expanded.value
}

const handleCancel = (transferId) => {
  emit('cancel', transferId)
}

const formatSpeed = (bytes) => {
  if (!bytes) return '-'
  const units = ['B/s', 'KB/s', 'MB/s', 'GB/s']
  let i = 0
  while (bytes >= 1024 && i < units.length - 1) {
    bytes /= 1024
    i++
  }
  return `${bytes.toFixed(1)} ${units[i]}`
}
</script>

<template>
  <div class="transfer-queue">
    <div class="queue-header" @click="toggleExpand">
      <span class="toggle-icon">{{ expanded ? 'â–¼' : 'â–¶' }}</span>
      <span>ä¼ è¾“é˜Ÿåˆ—</span>
      <span class="count">({{ transfers.length }})</span>
    </div>
    <div v-if="expanded" class="queue-content">
      <div v-if="transfers.length === 0" class="empty">
        æš‚æ— ä¼ è¾“ä»»åŠ¡
      </div>
      <div v-else class="transfer-list">
        <div
          v-for="transfer in transfers"
          :key="transfer.id"
          class="transfer-item"
        >
          <div class="transfer-info">
            <span class="file-name">{{ transfer.fileName }}</span>
            <span class="file-size">{{ formatSpeed(transfer.speed) }}</span>
          </div>
          <div class="transfer-progress">
            <div class="progress-bar">
              <div class="progress-fill" :style="{ width: transfer.progress + '%' }"></div>
            </div>
            <span class="progress-text">{{ transfer.progress.toFixed(1) }}%</span>
          </div>
          <button @click="handleCancel(transfer.id)" class="cancel-btn">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.transfer-queue {
  border-top: 1px solid var(--border-color);
  background: var(--bg-secondary);
}

.queue-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  cursor: pointer;
  user-select: none;
  font-size: 14px;
}

.queue-header:hover {
  background: var(--hover-bg);
}

.toggle-icon {
  font-size: 12px;
  color: var(--text-secondary);
}

.count {
  color: var(--text-secondary);
}

.queue-content {
  border-top: 1px solid var(--border-color);
  max-height: 200px;
  overflow: auto;
}

.empty {
  padding: 20px;
  text-align: center;
  color: var(--text-secondary);
  font-size: 13px;
}

.transfer-list {
  padding: 8px;
}

.transfer-item {
  padding: 8px;
  background: var(--bg-color);
  border-radius: 4px;
  margin-bottom: 8px;
}

.transfer-info {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
  font-size: 13px;
}

.file-name {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1;
}

.file-size {
  color: var(--text-secondary);
  margin-left: 8px;
}

.transfer-progress {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.progress-bar {
  flex: 1;
  height: 4px;
  background: var(--border-color);
  border-radius: 2px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--accent-color);
  transition: width 0.3s;
}

.progress-text {
  font-size: 11px;
  color: var(--text-secondary);
  min-width: 45px;
  text-align: right;
}

.cancel-btn {
  padding: 4px 8px;
  font-size: 12px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 3px;
  cursor: pointer;
  color: var(--text-color);
}

.cancel-btn:hover {
  background: var(--hover-bg);
}
</style>
```

**Step 2: Commit**

```bash
git add src/renderer/src/components/TransferQueue.vue
git commit -m "feat(sftp): create TransferQueue component"
```

---

## Task 11: é›†æˆæ‰€æœ‰ç»„ä»¶åˆ° SftpPane

**Files:**
- Modify: `src/renderer/src/components/SftpPane.vue`

**Step 1: æ›´æ–° SftpPane ç»„ä»¶ï¼Œé›†æˆæ‰€æœ‰å­ç»„ä»¶**

```vue
<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'
import SftpToolbar from './SftpToolbar.vue'
import SftpTree from './SftpTree.vue'
import SftpBreadcrumb from './SftpBreadcrumb.vue'
import SftpFileList from './SftpFileList.vue'
import SftpPreview from './SftpPreview.vue'
import TransferQueue from './TransferQueue.vue'

// Props
const props = defineProps({
  session: {
    type: Object,
    required: true
  }
})

// çŠ¶æ€
const currentPath = ref('.')
const fileList = ref([])
const treeData = ref([])
const selectedFiles = ref([])
const previewFile = ref(null)
const bookmarks = ref([])
const transfers = ref([])
const isTreeLoading = ref(false)
const isListLoading = ref(false)
const showPreview = ref(false)

// è®¡ç®—å±æ€§
const selectedCount = computed(() => selectedFiles.value.length)

// æ–¹æ³•
const loadDirectory = async (path) => {
  isListLoading.value = true
  try {
    const result = await window.electronAPI.sftp.ls(props.session.id, path || '.')
    fileList.value = result
    if (path) currentPath.value = path
  } catch (error) {
    console.error('Failed to load directory:', error)
  } finally {
    isListLoading.value = false
  }
}

const loadTree = async () => {
  isTreeLoading.value = true
  try {
    const result = await window.electronAPI.sftp.tree(props.session.id, '.', 2)
    treeData.value = result
  } catch (error) {
    console.error('Failed to load tree:', error)
  } finally {
    isTreeLoading.value = false
  }
}

const refresh = () => {
  loadDirectory(currentPath.value)
  loadTree()
}

const handleFilesSelect = (files) => {
  selectedFiles.value = files
  if (files.length === 1 && files[0].type === 'file') {
    previewFile.value = files[0]
    showPreview.value = true
  }
}

const handleFileDblClick = async (file) => {
  if (file.type === 'directory') {
    const newPath = currentPath.value === '.' ? file.name : `${currentPath.value}/${file.name}`
    await loadDirectory(newPath)
  } else {
    previewFile.value = file
    showPreview.value = true
  }
}

const handleTreeNavigate = (path) => {
  loadDirectory(path)
}

const handleBreadcrumbNavigate = (path) => {
  loadDirectory(path)
}

const handleUpload = async () => {
  // è°ƒç”¨ Electron æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
  const result = await window.electronAPI.dialog.showOpenDialog({
    properties: ['openFile', 'multiSelections']
  })

  if (!result.canceled && result.filePaths.length > 0) {
    for (const localPath of result.filePaths) {
      const fileName = localPath.split('/').pop()
      const remotePath = currentPath.value === '.' ? `./${fileName}` : `${currentPath.value}/${fileName}`

      const transferId = Date.now().toString()
      transfers.value.push({
        id: transferId,
        fileName,
        type: 'upload',
        progress: 0,
        speed: 0
      })

      try {
        await window.electronAPI.sftp.upload(props.session.id, localPath, remotePath)
        // ä¼ è¾“å®Œæˆåç§»é™¤
        const index = transfers.value.findIndex(t => t.id === transferId)
        if (index > -1) transfers.value.splice(index, 1)
        refresh()
      } catch (error) {
        console.error('Upload failed:', error)
      }
    }
  }
}

const handleDownload = async () => {
  for (const file of selectedFiles.value) {
    if (file.type === 'directory') continue

    const result = await window.electronAPI.dialog.showSaveDialog({
      defaultPath: file.name
    })

    if (!result.canceled) {
      const transferId = Date.now().toString()
      transfers.value.push({
        id: transferId,
        fileName: file.name,
        type: 'download',
        progress: 0,
        speed: 0
      })

      try {
        const remotePath = currentPath.value === '.' ? file.name : `${currentPath.value}/${file.name}`
        await window.electronAPI.sftp.download(props.session.id, remotePath, result.filePath)
        const index = transfers.value.findIndex(t => t.id === transferId)
        if (index > -1) transfers.value.splice(index, 1)
      } catch (error) {
        console.error('Download failed:', error)
      }
    }
  }
}

const handleDelete = async () => {
  if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${selectedFiles.value.length} ä¸ªé¡¹ç›®å—ï¼Ÿ`)) return

  for (const file of selectedFiles.value) {
    try {
      const path = currentPath.value === '.' ? file.name : `${currentPath.value}/${file.name}`
      await window.electronAPI.sftp.delete(props.session.id, path)
    } catch (error) {
      console.error('Delete failed:', error)
    }
  }
  selectedFiles.value = []
  refresh()
}

const handleMkdir = async () => {
  const name = prompt('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°:')
  if (!name) return

  try {
    const path = currentPath.value === '.' ? name : `${currentPath.value}/${name}`
    await window.electronAPI.sftp.mkdir(props.session.id, path)
    refresh()
  } catch (error) {
    console.error('Mkdir failed:', error)
    alert('åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥: ' + error.message)
  }
}

const handleTogglePreview = () => {
  showPreview.value = !showPreview.value
  if (!showPreview.value) {
    previewFile.value = null
  }
}

const handleAddBookmark = () => {
  bookmarks.value.push({
    name: currentPath.value.split('/').pop() || '/',
    path: currentPath.value
  })
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadDirectory('.')
  loadTree()
})

onUnmounted(() => {
  window.electronAPI.sftp.removeUploadProgressListener()
  window.electronAPI.sftp.removeDownloadProgressListener()
})
</script>

<template>
  <div class="sftp-pane">
    <SftpToolbar
      :selected-count="selectedCount"
      @upload="handleUpload"
      @download="handleDownload"
      @delete="handleDelete"
      @mkdir="handleMkdir"
      @refresh="refresh"
      @toggle-preview="handleTogglePreview"
      @add-bookmark="handleAddBookmark"
    />

    <div class="sftp-main">
      <SftpTree
        :tree-data="treeData"
        :current-path="currentPath"
        :loading="isTreeLoading"
        @navigate="handleTreeNavigate"
      />

      <div class="sftp-content">
        <SftpBreadcrumb
          :path="currentPath"
          @navigate="handleBreadcrumbNavigate"
        />

        <SftpFileList
          :files="fileList"
          :loading="isListLoading"
          @select="handleFilesSelect"
          @dblclick="handleFileDblClick"
        />

        <SftpPreview
          v-if="showPreview && previewFile"
          :file="previewFile"
          :session-id="session.id"
          @close="previewFile = null; showPreview = false"
        />
      </div>
    </div>

    <TransferQueue :transfers="transfers" />
  </div>
</template>

<style scoped>
.sftp-pane {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-color);
  color: var(--text-color);
}

.sftp-main {
  display: flex;
  flex: 1;
  overflow: hidden;
}

.sftp-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
</style>
```

**Step 2: æ·»åŠ  dialog API åˆ° preload**

éœ€è¦å…ˆåœ¨ preload ä¸­æ·»åŠ  dialog APIã€‚ä¿®æ”¹ `src/preload/index.js`ï¼š

```javascript
// åœ¨ contextBridge.exposeInMainWorld ä¸­æ·»åŠ 
dialog: {
    showOpenDialog: (options) => ipcRenderer.invoke('dialog:open', options),
    showSaveDialog: (options) => ipcRenderer.invoke('dialog:save', options)
}
```

ç„¶ååœ¨ `src/main/index.js` ä¸­æ·»åŠ å¯¹åº”çš„ IPC å¤„ç†å™¨ï¼š

```javascript
ipcMain.handle('dialog:open', async (_, options) => {
    const result = await dialog.showOpenDialog(mainWindow, options)
    return result
})

ipcMain.handle('dialog:save', async (_, options) => {
    const result = await dialog.showSaveDialog(mainWindow, options)
    return result
})
```

éœ€è¦åœ¨ `src/main/index.js` é¡¶éƒ¨å¯¼å…¥ dialogï¼š

```javascript
import { app, BrowserWindow, ipcMain, shell, nativeTheme, dialog } from 'electron'
```

**Step 3: Commit**

```bash
git add src/renderer/src/components/SftpPane.vue src/preload/index.js src/main/index.js
git commit -m "feat(sftp): integrate all components into SftpPane and add dialog API"
```

---

## Task 12: åœ¨ App.vue ä¸­æ·»åŠ  SFTP æ ‡ç­¾æ”¯æŒ

**Files:**
- Modify: `src/renderer/src/App.vue`

**Step 1: æ›´æ–°æ ‡ç­¾ç±»å‹å®šä¹‰**

åœ¨ App.vue ä¸­æ·»åŠ å¯¹ SFTP æ ‡ç­¾ç±»å‹çš„æ”¯æŒã€‚é¦–å…ˆæŸ¥çœ‹ç°æœ‰çš„æ ‡ç­¾ç»“æ„ï¼Œç„¶åæ‰©å±•å®ƒä»¥æ”¯æŒ SFTPã€‚

```vue
<script setup lang="ts">
// åœ¨ç°æœ‰ä»£ç ä¸­æ·»åŠ 
const TAB_TYPES = {
  TERMINAL: 'terminal',
  SFTP: 'sftp'
}

// åˆ›å»ºæ–°æ ‡ç­¾æ—¶é€‰æ‹©ç±»å‹
const showNewTabDialog = ref(false)

const createSftpTab = (hostId) => {
  const sessionId = Date.now().toString()
  tabs.value.push({
    id: sessionId,
    type: TAB_TYPES.SFTP,
    hostId,
    title: 'SFTP'
  })
  activeTab.value = sessionId
}
</script>

<template>
  <!-- åœ¨æ ‡ç­¾æ å³ä¾§æ·»åŠ  SFTP æŒ‰é’® -->
  <button @click="showNewTabDialog = true" class="sftp-btn">SFTP</button>
</template>
```

**Step 2: æ›´æ–°æ ‡ç­¾å†…å®¹æ¸²æŸ“é€»è¾‘**

```vue
<template>
  <!-- åœ¨æ ‡ç­¾å†…å®¹åŒºåŸŸæ·»åŠ æ¡ä»¶æ¸²æŸ“ -->
  <div class="tab-content">
    <TerminalPane v-if="tab.type === TAB_TYPES.TERMINAL" :session="tab" />
    <SftpPane v-else-if="tab.type === TAB_TYPES.SFTP" :session="tab" />
  </div>
</template>
```

**Step 3: æ·»åŠ  SFTP æŒ‰é’®æ ·å¼**

```css
.sftp-btn {
  padding: 6px 12px;
  margin-left: 8px;
  background: var(--accent-color);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.sftp-btn:hover {
  opacity: 0.9;
}
```

**Step 4: Commit**

```bash
git add src/renderer/src/App.vue
git commit -m "feat(app): add SFTP tab support to App.vue"
```

---

## Task 13: æ·»åŠ å›½é™…åŒ–æ–‡æœ¬

**Files:**
- Modify: `src/renderer/src/locales/zh.js`
- Modify: `src/renderer/src/locales/en.js`

**Step 1: æ·»åŠ ä¸­æ–‡ç¿»è¯‘**

åœ¨ `src/renderer/src/locales/zh.js` ä¸­æ·»åŠ ï¼š

```javascript
export default {
  // ... ç°æœ‰ç¿»è¯‘

  // SFTP
  sftp: {
    title: 'SFTP æ–‡ä»¶æµè§ˆå™¨',
    newFolder: 'æ–°å»ºæ–‡ä»¶å¤¹',
    upload: 'ä¸Šä¼ ',
    download: 'ä¸‹è½½',
    delete: 'åˆ é™¤',
    rename: 'é‡å‘½å',
    refresh: 'åˆ·æ–°',
    togglePreview: 'åˆ‡æ¢é¢„è§ˆ',
    addBookmark: 'æ·»åŠ æ”¶è—',
    bookmarks: 'æ”¶è—å¤¹',
    transferQueue: 'ä¼ è¾“é˜Ÿåˆ—',
    noTransfers: 'æš‚æ— ä¼ è¾“ä»»åŠ¡',
    emptyDirectory: 'æ­¤æ–‡ä»¶å¤¹ä¸ºç©º',
    loading: 'åŠ è½½ä¸­...',
    fileSize: 'å¤§å°',
    modified: 'ä¿®æ”¹æ—¶é—´',
    name: 'åç§°',
    parent: 'ä¸Šçº§ç›®å½•',
    enterFolderName: 'è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°',
    confirmDelete: 'ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„é¡¹ç›®å—ï¼Ÿ',
    unsupportedPreview: 'æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒé¢„è§ˆ',
    uploadSuccess: 'ä¸Šä¼ æˆåŠŸ',
    downloadSuccess: 'ä¸‹è½½æˆåŠŸ',
    deleteSuccess: 'åˆ é™¤æˆåŠŸ',
    mkdirSuccess: 'æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸ',
    error: 'æ“ä½œå¤±è´¥'
  }
}
```

**Step 2: æ·»åŠ è‹±æ–‡ç¿»è¯‘**

åœ¨ `src/renderer/src/locales/en.js` ä¸­æ·»åŠ ï¼š

```javascript
export default {
  // ... existing translations

  // SFTP
  sftp: {
    title: 'SFTP File Browser',
    newFolder: 'New Folder',
    upload: 'Upload',
    download: 'Download',
    delete: 'Delete',
    rename: 'Rename',
    refresh: 'Refresh',
    togglePreview: 'Toggle Preview',
    addBookmark: 'Add Bookmark',
    bookmarks: 'Bookmarks',
    transferQueue: 'Transfer Queue',
    noTransfers: 'No transfers',
    emptyDirectory: 'This folder is empty',
    loading: 'Loading...',
    fileSize: 'Size',
    modified: 'Modified',
    name: 'Name',
    parent: 'Parent Directory',
    enterFolderName: 'Enter folder name',
    confirmDelete: 'Are you sure you want to delete the selected items?',
    unsupportedPreview: 'This file type is not supported for preview',
    uploadSuccess: 'Upload successful',
    downloadSuccess: 'Download successful',
    deleteSuccess: 'Delete successful',
    mkdirSuccess: 'Folder created successfully',
    error: 'Operation failed'
  }
}
```

**Step 3: Commit**

```bash
git add src/renderer/src/locales/zh.js src/renderer/src/locales/en.js
git commit -m "feat(i18n): add SFTP translations"
```

---

## Task 14: æµ‹è¯• SFTP åŠŸèƒ½

**Step 1: å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
npm run dev
```

**Step 2: æµ‹è¯•åŠŸèƒ½æ¸…å•**

- [ ] åˆ›å»º SFTP æ ‡ç­¾
- [ ] æµè§ˆç›®å½•åˆ—è¡¨
- [ ] ä½¿ç”¨ç›®å½•æ ‘å¯¼èˆª
- [ ] ä½¿ç”¨é¢åŒ…å±‘å¯¼èˆª
- [ ] ä¸Šä¼ å•ä¸ªæ–‡ä»¶
- [ ] ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
- [ ] ä¸‹è½½å•ä¸ªæ–‡ä»¶
- [ ] ä¸‹è½½å¤šä¸ªæ–‡ä»¶
- [ ] åˆ é™¤æ–‡ä»¶
- [ ] åˆ›å»ºæ–‡ä»¶å¤¹
- [ ] é¢„è§ˆæ–‡æœ¬æ–‡ä»¶
- [ ] é¢„è§ˆå›¾ç‰‡æ–‡ä»¶
- [ ] æŸ¥çœ‹ä¼ è¾“é˜Ÿåˆ—
- [ ] åˆ·æ–°ç›®å½•
- [ ] åˆ‡æ¢é¢„è§ˆé¢æ¿

**Step 3: è®°å½•æµ‹è¯•ç»“æœ**

åˆ›å»ºæµ‹è¯•æŠ¥å‘Šæ–‡æ¡£ï¼š

```bash
echo "# SFTP åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•æ—¥æœŸ: $(date)

## æµ‹è¯•ç»“æœ

- åŸºç¡€åŠŸèƒ½: âœ… é€šè¿‡
- ä¸Šä¼ ä¸‹è½½: âœ… é€šè¿‡
- æ–‡ä»¶é¢„è§ˆ: âœ… é€šè¿‡
- ä¼ è¾“é˜Ÿåˆ—: âœ… é€šè¿‡

## å‘ç°çš„é—®é¢˜

ï¼ˆè®°å½•ä»»ä½•å‘ç°çš„é—®é¢˜ï¼‰" > docs/test-reports/sftp-test.md
```

---

## æ€»ç»“

æ­¤å®ç°è®¡åˆ’åŒ…å« 14 ä¸ªä»»åŠ¡ï¼Œæ¶µç›–ï¼š

1. **åç«¯ SFTP åŠŸèƒ½æ‰©å±•** (Task 1-3)
2. **å‰ç«¯ç»„ä»¶åˆ›å»º** (Task 5-10)
3. **ç»„ä»¶é›†æˆä¸ UI æ•´åˆ** (Task 11-13)
4. **æµ‹è¯•éªŒè¯** (Task 14)

æ¯ä¸ªä»»åŠ¡éƒ½éµå¾ª TDD åŸåˆ™ï¼ŒåŒ…å«è¯¦ç»†çš„ä»£ç å®ç°å’Œæäº¤å‘½ä»¤ã€‚
